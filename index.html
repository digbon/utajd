<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procesador de Texto</title>
    <style>
        #output .box {
            display: inline-block;
            border: 1px solid #000;
            margin: 5px;
            padding: 5px;
        }

        .green {
            color: green;
        }

        .red {
            color: red;
        }

        .purple {
            color: purple;
        }

        .label {
            color: gray;
        }

        .editable {
            border: 1px solid #aaa;
            margin: 0;
        }

        .copyIcon {
            cursor: pointer;
            margin-left: 10px;
        }
    </style>
</head>

<body>
    <h2>Pega tu texto aquÃ­:</h2>
    <textarea id="inputText" rows="10" cols="50"></textarea>
    <br>
    <button id="processBtn">Procesar</button>
    <h2>Resultado:</h2>
    <button id="exportBtn">Exportar a JSON</button>
    <button id="importBtn" onclick="document.getElementById('importJson').click()">Importar de JSON</button>
    <input type="file" id="importJson" style="display: none;" onchange="importFromJson()">
    <div id="output"></div>

    <h2>Texto Verde Todo Junto: <span class="copyIcon" onclick="copyToClipboard('.joinedText.green')">ðŸ“‹</span></h2>
    <div class="joinedText green"></div>

    <h2>Texto Rojo Todo Junto: <span class="copyIcon" onclick="copyToClipboard('.joinedText.red')">ðŸ“‹</span></h2>
    <div class="joinedText red"></div>

    <h2>Texto Morado Todo Junto: <span class="copyIcon" onclick="copyToClipboard('.joinedText.purple')">ðŸ“‹</span></h2>
    <div class="joinedText purple"></div>

    <script>
        let redWordsArray = [];
        let purpleWordsArray = [];
        let greenWordsArray = [];

        function processText(redArray, purpleArray, greenArray) {
            const input = document.getElementById("inputText").value;
            const output = document.getElementById("output");
            output.innerHTML = '';

            redWordsArray = redArray || [];
            purpleWordsArray = purpleArray || [];
            greenWordsArray = greenArray || [];

            const paragraphs = input.split(".");
            let pf = 0;

            for (let p of paragraphs) {
                let words = p.trim().split(" ");
                if (words.length >= 20) {
                    pf++;
                    let pp = 0;
                    for (let word of words) {
                        pp++;
                        appendWord(word, pf, pp, redWordsArray[pp-1], purpleWordsArray[pp-1]);
                        greenWordsArray.push(word);
                    }
                }
            }
            updateJoinedTexts();
        }

        function appendWord(word, pf, pp, redWord, purpleWord) {
            const output = document.getElementById("output");

            const wordContainer = document.createElement('div');
            wordContainer.className = "box";

            const items = [
                { className: 'label', text: `pf${pf} pp${pp} ` },
                { className: 'green', text: word },
                { className: 'red editable', value: redWord || word, type: 'red', index: pp - 1 },
                { className: 'purple editable', value: purpleWord || word, type: 'purple', index: pp - 1 }
            ];

            for (let item of items) {
                if ('text' in item) {
                    const span = document.createElement('span');
                    span.className = item.className;
                    span.textContent = item.text;
                    wordContainer.appendChild(span);
                } else {
                    const input = document.createElement('input');
                    input.className = item.className;
                    input.value = item.value;
                    input.dataset.type = item.type;
                    input.dataset.index = item.index;
                    input.addEventListener('input', function() {
                        if (this.dataset.type === 'red') {
                            redWordsArray[this.dataset.index] = this.value;
                        } else {
                            purpleWordsArray[this.dataset.index] = this.value;
                        }
                        updateJoinedTexts();
                    });
                    wordContainer.appendChild(input);
                }
                if (item.className !== 'purple editable') {
                    wordContainer.appendChild(document.createElement('br'));
                }
            }

            output.appendChild(wordContainer);
        }

        function updateJoinedTexts() {
            const redText = Array.from(document.querySelectorAll(".red.editable")).map(el => el.value).join(" ");
            const purpleText = Array.from(document.querySelectorAll(".purple.editable")).map(el => el.value).join(" ");
            
            document.querySelector(".joinedText.green").textContent = greenWordsArray.join(" ");
            document.querySelector(".joinedText.red").textContent = redText;
            document.querySelector(".joinedText.purple").textContent = purpleText;
        }

        function copyToClipboard(selector) {
            const textArea = document.createElement("textarea");
            textArea.value = document.querySelector(selector).textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Texto copiado al portapapeles!');
        }

        function exportToJson() {
            const data = {
                inputText: document.getElementById("inputText").value,
                redWordsArray: redWordsArray,
                purpleWordsArray: purpleWordsArray,
                greenWordsArray: greenWordsArray
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "data.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        function importFromJson() {
            const fileInput = document.getElementById("importJson");
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = JSON.parse(event.target.result);
                    document.getElementById("inputText").value = data.inputText;
                    processText(data.redWordsArray, data.purpleWordsArray, data.greenWordsArray);
                };
                reader.readAsText(file);
            }
        }

        document.getElementById("processBtn").addEventListener("click", function() {
            processText();
        });

        document.getElementById("exportBtn").addEventListener("click", exportToJson);
    </script>
</body>

</html>
