<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procesador de Texto</title>
    <style>
        #output .box,
        .joinedText .box {
            display: inline-block;
            border: 1px solid #000;
            margin: 5px;
            padding: 5px;
        }

        .green {
            color: green;
        }

        .red {
            color: red;
        }

        .purple {
            color: purple;
        }

        .label {
            color: gray;
        }

        .editable {
            border: 1px solid #aaa;
        }

        .copyIcon {
            cursor: pointer;
            margin-left: 10px;
        }
    </style>
</head>

<body>
    <h2>Pega tu texto aquÃ­:</h2>
    <textarea id="inputText" rows="10" cols="50"></textarea>
    <br>
    <button id="processBtn">Procesar</button>
    <h2>Resultado:</h2>
    <button id="exportBtn">Exportar a JSON</button>
    <input type="file" id="importJson" onchange="importFromJson()" style="display: none;">
    <button id="importBtn">Importar de JSON</button>
    <div id="output"></div>

    <h2>Texto Verde Todo Junto: <span class="copyIcon" onclick="copyToClipboard('.joinedText.green')">ðŸ“‹</span></h2>
    <div class="joinedText green"></div>

    <h2>Texto Rojo Todo Junto: <span class="copyIcon" onclick="copyToClipboard('.joinedText.red')">ðŸ“‹</span></h2>
    <div class="joinedText red"></div>

    <h2>Texto Morado Todo Junto: <span class="copyIcon" onclick="copyToClipboard('.joinedText.purple')">ðŸ“‹</span></h2>
    <div class="joinedText purple"></div>

    <script>
        let redWordsArray = [];
        let purpleWordsArray = [];
        let greenWordsArray = [];

        function processText() {
            const input = document.getElementById("inputText").value;
            const output = document.getElementById("output");

            output.innerHTML = '';

            redWordsArray = [];
            purpleWordsArray = [];
            greenWordsArray = [];

            const paragraphs = input.split(".");
            let pf = 0;

            for (let p of paragraphs) {
                let words = p.trim().split(" ");
                if (words.length >= 20) {
                    pf++;
                    let pp = 0;
                    for (let word of words) {
                        pp++;
                        appendWord(word, pf, pp);
                    }
                }
            }
            updateJoinedTexts();
        }

        function appendWord(word, pf, pp) {
            const output = document.getElementById("output");

            redWordsArray.push(word);
            purpleWordsArray.push(word);
            greenWordsArray.push(word);

            const items = [
                { className: 'label', text: `pf${pf} pp${pp} ` },
                { className: 'box green', text: word },
                { className: 'box red editable', value: word, type: 'red', index: redWordsArray.length - 1 },
                { className: 'box purple editable', value: word, type: 'purple', index: purpleWordsArray.length - 1 }
            ];

            for (let item of items) {
                if ('text' in item) {
                    const span = document.createElement('span');
                    span.className = item.className;
                    span.textContent = item.text;
                    output.appendChild(span);
                } else {
                    const input = document.createElement('input');
                    input.className = item.className;
                    input.value = item.value;
                    input.dataset.type = item.type;
                    input.dataset.index = item.index;
                    input.addEventListener('input', function() {
                        if (this.dataset.type === 'red') {
                            redWordsArray[this.dataset.index] = this.value;
                        } else {
                            purpleWordsArray[this.dataset.index] = this.value;
                        }
                        updateJoinedTexts();
                    });
                    output.appendChild(input);
                }
                output.appendChild(document.createElement('br'));
            }
        }

        function updateJoinedTexts() {
            const greenText = document.querySelector(".joinedText.green");
            const redText = document.querySelector(".joinedText.red");
            const purpleText = document.querySelector(".joinedText.purple");

            greenText.textContent = greenWordsArray.join(" ");
            redText.textContent = redWordsArray.join(" ");
            purpleText.textContent = purpleWordsArray.join(" ");
        }

        function copyToClipboard(selector) {
            const el = document.querySelector(selector);
            const textArea = document.createElement("textarea");
            textArea.value = el.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Texto copiado al portapapeles!');
        }

        function exportToJson() {
            const data = {
                inputText: document.getElementById("inputText").value,
                redWordsArray: redWordsArray,
                purpleWordsArray: purpleWordsArray,
                greenWordsArray: greenWordsArray
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "data.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        function importFromJson() {
            const fileInput = document.getElementById("importJson");
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = JSON.parse(event.target.result);
                    document.getElementById("inputText").value = data.inputText;
                    redWordsArray = data.redWordsArray || [];
                    purpleWordsArray = data.purpleWordsArray || [];
                    greenWordsArray = data.greenWordsArray || [];
                    processText();
                };
                reader.readAsText(file);
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("processBtn").addEventListener("click", processText);
            document.getElementById("exportBtn").addEventListener("click", exportToJson);
            document.getElementById("importBtn").addEventListener("click", function() {
                document.getElementById('importJson').click();
            });
        });
    </script>
</body>

</html>
